<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOLDEN INDEX å®Œå…¨ç‰ˆ</title>
    <style>
        :root { --bg-main: #0b0f19; --bg-card: #151b2b; --bg-box: #1e2538; --text-main: #e2e8f0; --text-sub: #94a3b8; --accent-gold: #fbbf24; --accent-gold-hover: #f59e0b; --accent-blue: #3b82f6; --border-color: #2e3c56; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg-main); color: var(--text-main); font-family: 'Helvetica Neue', Arial, sans-serif; padding: 20px; font-size: 14px; }
        header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .logo { width: 40px; height: 40px; background: #333; color: var(--accent-gold); display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 20px; }
        .header-title h1 { font-size: 16px; font-weight: bold; }
        .header-title p { font-size: 11px; color: var(--text-sub); }
        .controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .control-group label { font-size: 12px; color: var(--text-sub); }
        input, select { background: var(--bg-card); color: white; border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 6px; font-size: 14px; outline: none; }
        .checkbox-group { flex-direction: row; align-items: center; gap: 8px; padding-bottom: 8px; }
        .gold-btn { background: var(--accent-gold); color: #000; font-weight: bold; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; box-shadow: 0 0 10px rgba(251, 191, 36, 0.3); transition: 0.2s;}
        .gold-btn:hover { background: var(--accent-gold-hover); transform: scale(1.05); }
        .outline-btn { background: transparent; border: 1px solid var(--text-sub); color: var(--text-main); padding: 6px 15px; border-radius: 15px; cursor: pointer; font-size: 12px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .card-header { font-size: 15px; font-weight: bold; margin-bottom: 15px; }
        .note { font-size: 11px; color: var(--text-sub); margin-top: 10px; }
        .exh-row { display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .boat-num { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--text-sub); display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .boat-info { width: 180px; }
        .boat-info .name { font-weight: bold; font-size: 15px; }
        .boat-info .stats { font-size: 10px; color: var(--text-sub); }
        .slider-group { display: flex; align-items: center; gap: 8px; flex: 1; font-size: 11px; color: var(--text-sub); }
        input[type=range] { -webkit-appearance: none; width: 70px; height: 4px; background: #333; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--accent-blue); cursor: pointer; }
        .time-input { width: 50px; padding: 4px; font-size: 12px; text-align: center; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-2x2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .dash-box { background: var(--bg-box); padding: 15px; border-radius: 8px; display: flex; flex-direction: column; gap: 5px; border: 1px solid var(--border-color); }
        .dash-label { font-size: 12px; color: var(--text-sub); }
        .dash-value { font-size: 18px; font-weight: bold; transition: 0.3s; }
        .warning { color: #ef4444; }
        .index-row { display: flex; align-items: center; gap: 15px; background: var(--bg-box); padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border-color); transition: all 0.3s; }
        .index-mark { width: 30px; text-align: center; font-weight: bold; font-size: 16px; }
        .index-score { font-size: 20px; font-weight: bold; width: 60px; text-align: right; color: var(--accent-gold); }
        .index-tags { flex: 1; display: flex; gap: 5px; flex-wrap: wrap; }
        .tag { font-size: 10px; background: #333; padding: 2px 6px; border-radius: 4px; }
        .rank { font-size: 12px; color: var(--text-sub); }
        .weight-info { font-size: 11px; color: var(--text-sub); margin-bottom: 15px; }
        .buy-tags { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .buy-tag { background: var(--bg-box); border: 1px solid var(--border-color); padding: 5px 12px; border-radius: 15px; font-weight: bold; }
        .buy-allocation { font-family: monospace; font-size: 13px; margin-bottom: 15px; color: var(--text-sub); line-height: 1.6; }
        footer { text-align: center; font-size: 11px; color: var(--text-sub); margin-top: 40px; }
    </style>
</head>
<body>
    <header>
        <div class="logo">G</div>
        <div class="header-title">
            <h1>GOLDEN INDEX å®Œå…¨ç‰ˆ</h1>
            <p id="last-updated">ãƒ‡ãƒ¼ã‚¿: èª­è¾¼ä¸­...</p>
        </div>
    </header>

    <nav class="controls">
        <div class="control-group"><label>æ—¥ä»˜</label><input type="date" id="date-select" value="2026-02-18"></div>
        <div class="control-group"><label>å ´</label><select id="venue-select"></select></div>
        <div class="control-group">
            <label>R</label>
            <select id="race-select">
                <option value="1">1R</option><option value="2">2R</option><option value="3" selected>3R</option>
                <option value="4">4R</option><option value="5">5R</option><option value="6">6R</option>
                <option value="7">7R</option><option value="8">8R</option><option value="9">9R</option>
                <option value="10">10R</option><option value="11">11R</option><option value="12">12R</option>
            </select>
        </div>
        <div class="control-group">
            <label>é–‹å‚¬æ—¥æ•°</label>
            <select id="day-select">
                <option value="1">1æ—¥ç›®</option><option value="2">2æ—¥ç›®</option><option value="3">3æ—¥ç›®</option>
                <option value="4">4æ—¥ç›®</option><option value="5" selected>5æ—¥ç›®</option><option value="6">6æ—¥ç›®</option>
                <option value="7">æœ€çµ‚æ—¥</option>
            </select>
        </div>
        <div class="control-group"><label>äºˆç®—(å††)</label><input type="number" id="budget-input" value="5000" step="100"></div>
        <div class="control-group checkbox-group"><input type="checkbox" id="pro-toggle" checked><label for="pro-toggle">Proè¡¨ç¤º</label></div>
        <button id="calc-btn" class="gold-btn">å†è¨ˆç®—ï¼ˆå±•ç¤ºåæ˜ ï¼‰</button>
    </nav>

    <main>
        <section class="card" id="exhibition-section">
            <div class="card-header">å±•ç¤ºå…¥åŠ› (è¡Œ/ä¼¸/å› : 0ã€œ10)</div>
            <div id="exhibition-list" class="boat-list"></div>
            <div class="note">â€»ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã€Œå†è¨ˆç®—ã€ã‚’æŠ¼ã™ã¨ã€ã‚ãªãŸã®å±•ç¤ºè©•ä¾¡ãŒæŒ‡æ•°ã¨è²·ã„ç›®ã«åæ˜ ã•ã‚Œã¾ã™ã€‚</div>
        </section>

        <div class="dashboard-grid">
            <section class="card" id="conclusion-section">
                <div class="card-header">çµè«–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                <div class="grid-2x2">
                    <div class="dash-box"><span class="dash-label">ãƒ¬ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—</span><span class="dash-value" id="dash-type">èª­è¾¼ä¸­</span></div>
                    <div class="dash-box"><span class="dash-label">è’ã‚Œåº¦</span><span class="dash-value" id="dash-roughness">èª­è¾¼ä¸­</span></div>
                    <div class="dash-box"><span class="dash-label">å‹è² åº¦</span><span class="dash-value" id="dash-confidence">èª­è¾¼ä¸­</span></div>
                    <div class="dash-box"><span class="dash-label">æ³¨æ„</span><span class="dash-value warning" id="dash-warning">èª­è¾¼ä¸­</span></div>
                </div>
            </section>
            <section class="card" id="index-section">
                <div class="card-header">å½“æ—¥æŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
                <div class="weight-info" id="weight-info"></div>
                <div id="index-list" class="boat-list"></div>
            </section>
        </div>

        <section class="card" id="buy-section">
            <div class="card-header" id="buy-title">è²·ã„ç›®</div>
            <div class="buy-tags" id="buy-tags"></div>
            <div class="buy-allocation" id="buy-allocation"></div>
            <button class="outline-btn" id="copy-btn">å…±æœ‰æ–‡ã‚³ãƒ”ãƒ¼</button>
        </section>
    </main>

    <script>
        let appData = null;
        let currentBoats = []; 
        const VENUES = ["01_æ¡ç”Ÿ", "02_æˆ¸ç”°", "03_æ±Ÿæˆ¸å·", "04_å¹³å’Œå³¶", "05_å¤šæ‘©å·", "06_æµœåæ¹–", "07_è’²éƒ¡", "08_å¸¸æ»‘", "09_æ´¥", "10_ä¸‰å›½", "11_ã³ã‚ã“", "12_ä½ä¹‹æ±Ÿ", "13_å°¼å´", "14_é³´é–€", "15_ä¸¸äº€", "16_å…å³¶", "17_å®®å³¶", "18_å¾³å±±", "19_ä¸‹é–¢", "20_è‹¥æ¾", "21_èŠ¦å±‹", "22_ç¦å²¡", "23_å”æ´¥", "24_å¤§æ‘"];

        document.addEventListener("DOMContentLoaded", () => {
            initUI();
            fetchData();
            document.getElementById("calc-btn").addEventListener("click", () => updateUI(true));
            document.getElementById("day-select").addEventListener("change", () => updateUI(true));
            document.getElementById("pro-toggle").addEventListener("change", () => updateUI(false));
            document.getElementById("copy-btn").addEventListener("click", copyToClipboard);
        });

        function initUI() {
            const venueSelect = document.getElementById("venue-select");
            VENUES.forEach((v, i) => {
                let opt = document.createElement("option");
                opt.value = String(i + 1).padStart(2, '0');
                opt.textContent = v;
                if(v.includes("æˆ¸ç”°")) opt.selected = true;
                venueSelect.appendChild(opt);
            });
        }

        async function fetchData() {
            try {
                const response = await fetch('data/db.json');
                if (!response.ok) throw new Error("JSONèª­ã¿è¾¼ã¿å¤±æ•—");
                appData = await response.json();
                document.getElementById("last-updated").textContent = `ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ: ${appData.updated_at || "ä¸æ˜"}`;
                
                // æœ¬æ¥ã¯ appData.venues ã‹ã‚‰å–å¾—ã€‚ä»Šå›ã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åˆå›ã‚»ãƒƒãƒˆ
                currentBoats = getInitialBoats();
                renderExhibition(currentBoats); // åˆå›ã¯å±•ç¤ºæ ã ã‘æç”»
                updateUI(false); 
            } catch (e) {
                console.warn(e);
                currentBoats = getInitialBoats();
                renderExhibition(currentBoats);
                updateUI(false);
            }
        }

        function updateUI(isRecalculate) {
            const isPro = document.getElementById("pro-toggle").checked;
            const budget = parseInt(document.getElementById("budget-input").value) || 5000;
            const dayOfEvent = parseInt(document.getElementById("day-select").value);

            // ã€å†è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã€‘ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’èª­ã¿å–ã£ã¦æŒ‡æ•°ã‚’ä¸Šæ›¸ãï¼
            if (isRecalculate) {
                const rows = document.querySelectorAll(".exh-row");
                rows.forEach((row, idx) => {
                    const sliders = row.querySelectorAll("input[type=range]");
                    const ikiasi = parseInt(sliders[0].value);
                    const nobi = parseInt(sliders[1].value);
                    const mawari = parseInt(sliders[2].value);
                    
                    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è©•ä¾¡(0-30)ã‚’0-100ã®å±•ç¤ºã‚¹ã‚³ã‚¢ã«å¤‰æ›
                    const exhScore = ((ikiasi + nobi + mawari) / 30) * 100;
                    
                    // æ—¥æ•°ã«ã‚ˆã£ã¦åŸºç¤ã¨å±•ç¤ºã®å‰²åˆã‚’å¤‰ãˆã‚‹ï¼ˆã‚¨ãƒ³ã‚¸ãƒ³ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
                    let weightBase = 0.5, weightExh = 0.5;
                    if(dayOfEvent <= 2) { weightBase = 0.7; weightExh = 0.3; }
                    else if(dayOfEvent >= 5) { weightBase = 0.3; weightExh = 0.7; }
                    
                    document.getElementById("weight-info").textContent = `é‡ã¿ (é–‹å‚¬${dayOfEvent}æ—¥ç›®): åŸºç¤ ${weightBase*100}% / å±•ç¤º ${weightExh*100}%`;

                    // å½“æ—¥æŒ‡æ•°ã‚’æ›´æ–°
                    currentBoats[idx].today_index = (currentBoats[idx].base_index * weightBase) + (exhScore * weightExh);
                });
            }

            // æŒ‡æ•°é †ã«ã‚½ãƒ¼ãƒˆã—ã¦ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
            let sortedBoats = [...currentBoats].sort((a, b) => b.today_index - a.today_index);
            
            // å°æ‰“ã¡
            const marks = ["â—", "â—‹", "â–³", "Ã—", "Ã—", ""];
            sortedBoats.forEach((b, i) => b.mark = marks[i]);

            renderIndexList(sortedBoats);
            renderDashboard(sortedBoats);
            renderBuyList(sortedBoats, budget, isPro);
        }

        function renderExhibition(boats) {
            const container = document.getElementById("exhibition-list");
            container.innerHTML = "";
            boats.forEach((b, i) => {
                container.innerHTML += `
                    <div class="exh-row">
                        <div class="boat-num">${b.number}</div>
                        <div class="boat-info">
                            <div class="name">${b.name}</div>
                            <div class="stats">ãƒ¢${b.motor}% / åŸºç¤æŒ‡æ•°: ${b.base_index.toFixed(1)}</div>
                        </div>
                        <div class="slider-group">è¡Œ<input type="range" min="0" max="10" value="5" id="iki-${i}"></div>
                        <div class="slider-group">ä¼¸<input type="range" min="0" max="10" value="5" id="nob-${i}"></div>
                        <div class="slider-group">å›<input type="range" min="0" max="10" value="5" id="maw-${i}"></div>
                        <input type="text" class="time-input" value="${b.time}" placeholder="6.70">
                    </div>
                `;
            });
        }

        function renderIndexList(boats) {
            const container = document.getElementById("index-list");
            container.innerHTML = "";
            boats.forEach((b, i) => {
                const tagsHtml = b.tags.map(t => `<span class="tag">${t}</span>`).join("");
                container.innerHTML += `
                    <div class="index-row">
                        <div class="boat-num">${b.number}</div>
                        <div class="boat-info">
                            <div class="name">${b.name}</div>
                            <div class="stats">åŸºç¤ ${b.base_index.toFixed(1)}</div>
                        </div>
                        <div class="index-mark">${b.mark}</div>
                        <div class="index-score">${b.today_index.toFixed(1)}</div>
                        <div class="index-tags">${tagsHtml}</div>
                        <div class="rank">${i + 1}ä½</div>
                    </div>
                `;
            });
        }

        function renderDashboard(sortedBoats) {
            const topBoat = sortedBoats[0].number;
            const isChaos = topBoat !== 1;

            document.getElementById("dash-type").textContent = isChaos ? "æ³¢ä¹±å«ã¿" : "ã‚¤ãƒ³æœ‰åˆ©";
            document.getElementById("dash-roughness").textContent = isChaos ? "é«˜ (77)" : "ä½ (23)";
            document.getElementById("dash-confidence").textContent = isChaos ? "S (å‹è² )" : "A (å …å®Ÿ)";
            
            const warningEl = document.getElementById("dash-warning");
            if(isChaos) {
                warningEl.textContent = `å±é™º: ${topBoat}å·è‰‡ã¾ãã‚Šè­¦æˆ’`;
                warningEl.className = "dash-value warning";
            } else {
                warningEl.textContent = "å®‰å®š: é€ƒã’å±•é–‹";
                warningEl.className = "dash-value";
                warningEl.style.color = "var(--text-sub)";
            }
        }

        function renderBuyList(boats, budget, isPro) {
            const title = document.getElementById("buy-title");
            title.textContent = isPro ? "è²·ã„ç›® (Proå±•é–‹ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)" : "è²·ã„ç›® (æœ¬å‘½6ç‚¹)";
            
            const marks = { "â—":null, "â—‹":null, "â–³":null, "Ã—":[] };
            boats.forEach(b => {
                if(b.mark === "â—") marks["â—"] = b.number;
                else if(b.mark === "â—‹") marks["â—‹"] = b.number;
                else if(b.mark === "â–³") marks["â–³"] = b.number;
                else if(b.mark === "Ã—") marks["Ã—"].push(b.number);
            });

            let buys = [];
            if (!isPro) {
                buys = [
                    `${marks["â—"]}-${marks["â—‹"]}-${marks["â–³"]}`, `${marks["â—"]}-${marks["â–³"]}-${marks["â—‹"]}`,
                    `${marks["â—"]}-${marks["â—‹"]}-${marks["Ã—"][0]}`, `${marks["â—"]}-${marks["â–³"]}-${marks["Ã—"][0]}`,
                    `${marks["â—‹"]}-${marks["â—"]}-${marks["â–³"]}`, `${marks["â–³"]}-${marks["â—"]}-${marks["â—‹"]}`
                ];
            } else {
                buys = [`${marks["â—"]}-${marks["â—‹"]}-å…¨`, `${marks["â—‹"]}-${marks["â—"]}-å…¨`, `${marks["â—"]}-${marks["â–³"]}-å…¨`];
            }

            const tagsContainer = document.getElementById("buy-tags");
            tagsContainer.innerHTML = buys.map(b => `<div class="buy-tag">${b}</div>`).join("");

            const allocContainer = document.getElementById("buy-allocation");
            const perBet = Math.floor(budget / buys.length / 100) * 100;
            allocContainer.innerHTML = buys.map(b => `${b} : ${perBet}å††`).join("<br>");
        }

        function copyToClipboard() {
            const text = document.getElementById("buy-allocation").innerText;
            navigator.clipboard.writeText("ã€GOLDEN INDEX æ¨å¥¨è²·ã„ç›®ã€‘\n" + text).then(() => alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
        }

        function getInitialBoats() {
            return [
                { number: 1, name: "å¤§ç€§æ˜æ—¥", motor: 23.7, st: 0.16, time: 6.72, base_index: 68.0, today_index: 60.0, tags: ["ğŸ”¥æ€¥æˆé•·"] },
                { number: 2, name: "å²¡è°·å¥å¾", motor: 25.0, st: 0.18, time: 6.72, base_index: 52.0, today_index: 50.6, tags: [] },
                { number: 3, name: "ä¼¯æ¯èŠ³æ’", motor: 25.0, st: 0.16, time: 6.72, base_index: 55.0, today_index: 52.7, tags: [] },
                { number: 4, name: "å®ŸåŠ›è€…A", motor: 30.0, st: 0.15, time: 6.70, base_index: 58.0, today_index: 55.0, tags: ["ğŸš€ã‚«ãƒ‰è­¦æˆ’"] },
                { number: 5, name: "åŒ—å·å¤ªä¸€", motor: 31.8, st: 0.15, time: 6.72, base_index: 54.0, today_index: 54.9, tags: [] },
                { number: 6, name: "ä¸Šæ‘å®å¤ª", motor: 42.8, st: 0.17, time: 6.72, base_index: 45.0, today_index: 45.0, tags: [] }
            ];
        }
    </script>
</body>
</html>